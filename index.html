<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Para√≠so FM 101,1 - Sobral | R√°dio Online</title>

  <!-- Google Analytics CORRETO -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-EF42RBHES1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-EF42RBHES1', {
      'custom_map': {
        'dimension1': 'user_city',
        'dimension2': 'detection_method',
        'dimension3': 'radio_station'
      }
    });
  </script>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <!-- Meta Tags -->
  <meta name="description" content="Ou√ßa a R√°dio Para√≠so FM 101.1 de Sobral ao vivo. Programa√ß√£o variada, not√≠cias locais e os melhores sucessos da regi√£o.">
  
  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="üìª Para√≠so FM 101,1 - Sobral">
  <meta property="og:description" content="Para√≠so FM de Sobral Ao vivo - Informa√ß√£o e entretenimento em um s√≥ lugar.">
  <meta property="og:image" content="'./turbinal_paraiso.png">
  <meta property="og:url" content="https://rivaldrss.github.io/paraiso_aovivo/">

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#1e90ff">
  <meta name="apple-mobile-web-app-capable" content="yes">

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: Arial, sans-serif;
      background: url(''./turbinal_paraiso.png') no-repeat center center fixed;
      background-size: cover;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      position: relative;
      color: #fff;
    }

    body::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.3);
      z-index: 0;
    }
    
    .player-card {
      position: relative;
      z-index: 2;
      background: rgba(0,0,0,0.70);
      border-radius: 25px;
      padding: 30px 25px;
      max-width: 500px;
      width: 95%;
      text-align: center;
      box-shadow: 0 15px 40px rgba(0,0,0,0.8);
      margin: 20px 10px;
    }
    
    .player-card header img {
      width: 110px;
      border-radius: 50%;
      border: 3px solid #fff;
      margin-bottom: 15px;
      display: block;
      margin-left: auto;
      margin-right: auto;
      box-shadow: 0 8px 20px rgba(0,0,0,0.5);
    }
    
    .player-card header h1 {
      font-size: 24px;
      margin-bottom: 15px;
      text-shadow: 2px 2px 8px rgba(0,0,0,0.8);
      font-weight: bold;
    }
    
    .player-container {
      background: rgba(255,255,255,0.08);
      border: 2px solid rgba(255,255,255,0.15);
      border-radius: 15px;
      padding: 20px;
      display: flex;
      align-items: center;
      gap: 15px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.6);
      margin-bottom: 20px;
    }
    
    .btn {
      background: rgba(255,255,255,0.15);
      border: none;
      color: #fff;
      font-size: 22px;
      border-radius: 12px;
      width: 65px;
      height: 50px;
      cursor: pointer;
      transition: transform .2s, background .2s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    
    .btn:hover {
      transform: scale(1.08);
      background: rgba(255,255,255,0.22);
    }
    
    .btn:active {
      transform: scale(0.98);
    }
    
    .volume {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .volume input[type="range"] {
      width: 100%;
      height: 8px;
      cursor: pointer;
      border-radius: 4px;
      background: rgba(255,255,255,0.1);
      -webkit-appearance: none;
    }
    
    .volume input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #1E90FF;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
    
    .volume input[type="range"]::-moz-range-thumb {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #1E90FF;
      cursor: pointer;
      border: none;
    }
    
    .volume-icons {
      display: flex;
      gap: 5px;
      color: rgba(255,255,255,0.7);
      font-size: 16px;
    }
    
    .status, .programacao {
      font-size: 15px;
      opacity: 0.95;
      margin-top: 8px;
      text-align: left;
      font-weight: 500;
    }
    
    .programacao {
      background: rgba(30, 144, 255, 0.2);
      padding: 12px 15px;
      border-radius: 10px;
      margin: 15px 0;
      border-left: 4px solid #1E90FF;
      font-size: 14px;
    }
    
    .social {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 20px 0 15px;
      align-items: center;
    }
    
    .social a {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 50px;
      height: 50px;
      border-radius: 12px;
      background: rgba(255,255,255,0.05);
      text-decoration: none;
      transition: transform .2s, background .2s;
      z-index: 3;
      color: inherit;
      border: 2px solid rgba(255,255,255,0.08);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    
    .social a:hover {
      transform: translateY(-4px);
      background: rgba(255,255,255,0.1);
    }
    
    .social a.instagram { color: #E1306C; }
    .social a.whatsapp { color: #25D366; }
    .social a.youtube { color: #FF0000; }
    .social a.site { color: #1E90FF; }
    
    .social i {
      font-size: 24px;
      display: block;
    }
    
    footer {
      font-size: 13px;
      opacity: 0.8;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid rgba(255,255,255,0.1);
    }

    /* Carrossel */
    .carrossel-container {
      margin: 20px 0;
      position: relative;
      overflow: hidden;
      border-radius: 15px;
      background: rgba(255,255,255,0.07);
      border: 2px solid rgba(255,255,255,0.12);
      min-height: 140px;
    }

    .carrossel {
      display: flex;
      transition: transform 0.5s ease-in-out;
    }

    .slide {
      min-width: 100%;
      background: rgba(255,255,255,0.07);
      padding: 25px;
    }

    .slide h3 {
      font-size: 18px;
      margin-bottom: 12px;
      color: #fff;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.7);
      border-bottom: 2px solid rgba(30, 144, 255, 0.6);
      padding-bottom: 10px;
      font-weight: bold;
    }

    .slide p {
      font-size: 15px;
      line-height: 1.6;
      margin-bottom: 18px;
      opacity: 0.9;
    }

    .slide a {
      display: inline-block;
      background: rgba(30, 144, 255, 0.8);
      color: white;
      padding: 12px 24px;
      text-decoration: none;
      border-radius: 8px;
      font-size: 15px;
      font-weight: bold;
      transition: all 0.3s ease;
      border: 2px solid rgba(255,255,255,0.3);
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(30, 144, 255, 0.3);
    }

    .slide a:hover {
      background: rgba(30, 144, 255, 0.95);
      transform: translateY(-3px);
      box-shadow: 0 6px 18px rgba(30, 144, 255, 0.4);
    }

    .controles {
      position: absolute;
      top: 50%;
      width: 100%;
      display: flex;
      justify-content: space-between;
      transform: translateY(-50%);
      padding: 0 15px;
    }

    .controles button {
      background: rgba(0,0,0,0.6);
      color: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    .controles button:hover {
      background: rgba(0,0,0,0.8);
      transform: scale(1.15);
    }

    .indicadores {
      display: flex;
      justify-content: center;
      gap: 10px;
      padding: 18px;
    }

    .indicador {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: rgba(255,255,255,0.3);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .indicador.ativo {
      background: #1E90FF;
      transform: scale(1.3);
      box-shadow: 0 2px 6px rgba(30, 144, 255, 0.5);
    }

    .carregando {
      text-align: center;
      padding: 50px 25px;
      color: rgba(255,255,255,0.7);
      font-size: 16px;
    }

    .erro {
      text-align: center;
      padding: 35px 25px;
      color: #ff6b6b;
      font-size: 15px;
      background: rgba(255,107,107,0.1);
      border-radius: 10px;
      margin: 15px;
      border: 1px solid rgba(255,107,107,0.3);
    }

    .data-noticia {
      font-size: 13px;
      color: rgba(255,255,255,0.7);
      margin-bottom: 15px;
      font-style: italic;
      background: rgba(255,255,255,0.05);
      padding: 6px 12px;
      border-radius: 6px;
      display: inline-block;
    }

    /* Location Badge */
    .location-badge {
      position: absolute;
      top: 15px;
      left: 15px;
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 13px;
      z-index: 1000;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
      max-width: 200px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .location-info {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .location-icon {
      font-size: 14px;
      flex-shrink: 0;
    }

    .location-text {
      font-weight: 500;
    }

    .location-badge.success {
      background: rgba(34, 197, 94, 0.9);
    }

    .location-badge.error {
      background: rgba(239, 68, 68, 0.9);
    }

    .location-badge.loading {
      background: rgba(59, 130, 246, 0.9);
    }

    /* Responsividade */
    @media (max-width: 768px) {
      .player-card {
        padding: 25px 20px;
        margin: 15px 10px;
      }
      
      .player-card header img {
        width: 100px;
      }
      
      .player-card header h1 {
        font-size: 22px;
      }
      
      .player-container {
        padding: 18px;
        gap: 12px;
      }
      
      .btn {
        width: 60px;
        height: 48px;
        font-size: 20px;
      }
      
      .social a {
        width: 48px;
        height: 48px;
      }
      
      .social i {
        font-size: 22px;
      }
      
      .location-badge {
        max-width: 160px;
      }
    }

    @media (max-width: 480px) {
      .player-card {
        padding: 20px 15px;
        margin: 10px 5px;
      }
      
      .player-card header img {
        width: 90px;
      }
      
      .player-card header h1 {
        font-size: 20px;
      }
      
      .player-container {
        padding: 15px;
        gap: 10px;
        flex-direction: column;
      }
      
      .btn {
        width: 70px;
        height: 55px;
        font-size: 24px;
        order: -1;
        margin-bottom: 10px;
      }
      
      .volume {
        width: 100%;
      }
      
      .status, .programacao {
        text-align: center;
        font-size: 14px;
      }
      
      .programacao {
        padding: 10px 12px;
        font-size: 13px;
      }
      
      .social {
        gap: 12px;
        margin: 18px 0 12px;
      }
      
      .social a {
        width: 45px;
        height: 45px;
      }
      
      .social i {
        font-size: 20px;
      }
      
      .slide {
        padding: 20px;
      }
      
      .slide h3 {
        font-size: 17px;
      }
      
      .slide p {
        font-size: 14px;
      }
      
      .slide a {
        padding: 10px 20px;
        font-size: 14px;
        width: 100%;
        text-align: center;
      }
      
      .controles button {
        width: 35px;
        height: 35px;
        font-size: 16px;
      }
      
      footer {
        font-size: 12px;
      }
      
      .location-badge {
        max-width: 140px;
      }
    }
  </style>
</head>
<body>
  <div class="player-card">
    <header>
      <img src="https://img.radios.com.br/radio/lg/radio14228_1674649732.jpeg" alt="Logo da R√°dio">
      <h1>Para√≠so FM 101,1 - Sobral</h1>
    </header>

    <div class="player-container">
      <button class="btn" id="playPause">‚ñ∂Ô∏è</button>
      <div class="volume">
        <div class="volume-icons">
          <span>üîà</span>
          <span>üîä</span>
        </div>
        <input type="range" id="volumeControl" min="0" max="1" step="0.01" value="0.7" aria-label="Volume">
      </div>
      <div style="min-width:120px; text-align:center;">
        <div class="status" id="status">Conectando...</div>
      </div>
    </div>

    <div class="programacao" id="programacao">üéôÔ∏è Programa atual: Carregando...</div>

    <!-- Carrossel de Not√≠cias -->
    <div class="carrossel-container">
      <div class="carrossel" id="carrossel">
        <div class="carregando">Carregando not√≠cias...</div>
      </div>
      
      <div class="controles">
        <button id="prevBtn">&#10094;</button>
        <button id="nextBtn">&#10095;</button>
      </div>
      
      <div class="indicadores" id="indicadores">
        <!-- Indicadores ser√£o inseridos aqui -->
      </div>
    </div>

    <!-- Redes Sociais -->
    <div class="social">
      <a class="instagram" href="https://www.instagram.com/sistemaparaiso" target="_blank" aria-label="Instagram">
        <i class="fab fa-instagram"></i>
      </a>
      <a class="whatsapp" href="https://wa.me/5588999834349" target="_blank" aria-label="WhatsApp">
        <i class="fab fa-whatsapp"></i>
      </a>
      <a class="youtube" href="https://www.youtube.com/@paraisofmsobral" target="_blank" aria-label="YouTube">
        <i class="fab fa-youtube"></i>
      </a>
      <a class="site" href="https://sistemaparaiso.com.br" target="_blank" aria-label="Site">
        <i class="fas fa-globe"></i>
      </a>
    </div>

    <footer>¬© 2025 Para√≠so FM 101,1 - Todos os direitos reservados</footer>
  </div>

  <audio id="player" crossorigin="anonymous">
    <source src="https://stm28.xcast.com.br:11582/stream" type="audio/mpeg">
    Seu navegador n√£o suporta o player de √°udio.
  </audio>

  <script>
    // ================= PLAYER PRINCIPAL CORRIGIDO =================
    const player = document.getElementById("player");
    const playPause = document.getElementById("playPause");
    const statusText = document.getElementById("status");
    const volumeControl = document.getElementById("volumeControl");
    const programacaoEl = document.getElementById("programacao");

    // Grade de programa√ß√£o
    const grade = [
      { dias: [1,2,3,4,5], inicio: "04:00", fim: "06:00", programa: "De Olho na Cidade" },
      { dias: [1,2,3,4,5], inicio: "06:00", fim: "08:00", programa: "Chama a Para√≠so" },
      { dias: [1,2,3,4,5], inicio: "08:00", fim: "09:00", programa: "Variedades" },
      { dias: [1,2,3,4,5], inicio: "09:00", fim: "11:00", programa: "Esta√ß√£o 101" },
      { dias: [1,2,3,4,5], inicio: "11:00", fim: "13:00", programa: "Hora da Not√≠cia" },
      { dias: [1,2,3,4,5], inicio: "13:00", fim: "15:00", programa: "Tribuna & Plen√°rio" },
      { dias: [1,2,3,4,5], inicio: "15:00", fim: "17:00", programa: "Forronejo" },
      { dias: [1,2,3,4,5], inicio: "17:00", fim: "19:00", programa: "Sucessos & Saudades" },
      { dias: [1,2,3,4,5], inicio: "19:00", fim: "20:00", programa: "A voz do Brasil" },
      { dias: [1,2,3,4,5], inicio: "20:00", fim: "22:00", programa: "Di√°rio Policial" },
      { dias: [1,2,3,4,5], inicio: "22:00", fim: "23:30", programa: "Plant√£o Alerta" },
      { dias: [1,2,3,4,5], inicio: "23:30", fim: "1:00", programa: "Para√≠so By Night" },
      { dias: [1,2,3,4,5], inicio: "1:00", fim: "2:00", programa: "Novo Tempo" },
      { dias: [1,2,3,4,5], inicio: "2:00", fim: "4:00", programa: "Madrugada 101" },
      { dias: [6], inicio: "06:00", fim: "09:00", programa: "Manh√£ Sertaneja" },
      { dias: [6], inicio: "09:00", fim: "12:00", programa: "Top Hits Para√≠so" },
      { dias: [6], inicio: "12:00", fim: "15:00", programa: "S√°bado Esportivo" },
      { dias: [6], inicio: "15:00", fim: "18:00", programa: "Especial Forr√≥ das Antigas" },
      { dias: [0], inicio: "06:00", fim: "09:00", programa: "Domingo de F√©" },
      { dias: [0], inicio: "09:00", fim: "12:00", programa: "Parad√£o Para√≠so" },
      { dias: [0], inicio: "12:00", fim: "15:00", programa: "Tarde de Sucessos" },
      { dias: [0], inicio: "15:00", fim: "18:00", programa: "Especial Samba & Pagode" }
    ];

    // Event listeners CORRETOS para o player
    player.addEventListener('playing', () => {
      statusText.textContent = "‚ñ∂Ô∏è Tocando Agora";
      statusText.style.color = "#4CAF50";
      playPause.textContent = "‚è∏Ô∏è";
      gtag('event', 'play', { 'event_category': 'Player', 'event_label': 'Ao vivo' });
    });
    
    player.addEventListener('pause', () => {
      statusText.textContent = "‚è∏Ô∏è Pausado";
      statusText.style.color = "#ff9800";
      playPause.textContent = "‚ñ∂Ô∏è";
      gtag('event', 'pause', { 'event_category': 'Player', 'event_label': 'Ao vivo' });
    });
    
    player.addEventListener('waiting', () => {
      statusText.textContent = "‚è≥ Conectando...";
      statusText.style.color = "#fff";
    });
    
    player.addEventListener('error', () => {
      statusText.textContent = "‚ö†Ô∏è Erro na transmiss√£o";
      statusText.style.color = "#ff6b6b";
      gtag('event', 'player_error', { 'event_category': 'Player', 'event_label': 'Erro streaming' });
    });

    // Play/Pause function
    playPause.addEventListener("click", () => {
      if (player.paused) {
        player.play().catch(() => { 
          statusText.textContent = "‚ñ∂Ô∏è Toque para iniciar";
          statusText.style.color = "#ff6b6b";
        });
      } else {
        player.pause();
      }
    });

    // Volume control
    volumeControl.addEventListener("input", (e) => {
      player.volume = e.target.value;
      gtag('event', 'volume_change', { 
        'event_category': 'Player', 
        'event_label': 'Volume', 
        'value': e.target.value 
      });
    });

    // Programa√ß√£o
    function horaEntre(hora, inicio, fim) {
      return (inicio <= fim) ? (hora >= inicio && hora < fim) : (hora >= inicio || hora < fim);
    }

    function atualizarProgramacao() {
      const agora = new Date();
      const diaSemana = agora.getDay();
      const horaAtual = agora.getHours().toString().padStart(2,"0") + ":" +
                        agora.getMinutes().toString().padStart(2,"0");

      const programaAtual = grade.find(p => p.dias.includes(diaSemana) && horaEntre(horaAtual, p.inicio, p.fim));

      programacaoEl.textContent = programaAtual 
        ? `üéôÔ∏è ${programaAtual.programa} (${programaAtual.inicio}-${programaAtual.fim})`
        : "üéôÔ∏è Fora do ar - Programa√ß√£o especial";
    }

    atualizarProgramacao();
    setInterval(atualizarProgramacao, 60000);

    // ================= SISTEMA DE DETEC√á√ÉO DE CIDADE =================
    class LocationTracker {
      constructor() {
        this.city = 'Detectando...';
        this.isDetecting = false;
        this.locationElement = null;
      }

      init() {
        this.createLocationUI();
        this.detectUserCity();
      }

      createLocationUI() {
        const locationBadge = document.createElement('div');
        locationBadge.className = 'location-badge loading';
        locationBadge.innerHTML = `
          <div class="location-info">
            <span class="location-icon">üìç</span>
            <span class="location-text">${this.city}</span>
          </div>
        `;

        const playerCard = document.querySelector('.player-card');
        if (playerCard) {
          playerCard.style.position = 'relative';
          playerCard.appendChild(locationBadge);
          this.locationElement = locationBadge;
        }
      }

      updateLocationUI(city, status = 'success') {
        this.city = city;
        if (this.locationElement) {
          const locationText = this.locationElement.querySelector('.location-text');
          if (locationText) {
            locationText.textContent = city;
          }
          this.locationElement.className = 'location-badge ' + status;
        }
      }

      async detectUserCity() {
        if (this.isDetecting) return;
        this.isDetecting = true;

        this.updateLocationUI('Detectando cidade...', 'loading');

        try {
          let city = await this.getCityByGPS();
          if (!city || city === 'Desconhecida') {
            city = await this.getCityByIP();
          }

          this.updateLocationUI(city, 'success');
          this.trackToAnalytics(city, 'location_detected');
        } catch (error) {
          this.updateLocationUI('Localiza√ß√£o indispon√≠vel', 'error');
        } finally {
          this.isDetecting = false;
        }
      }

      async getCityByGPS() {
        return new Promise((resolve) => {
          if (!navigator.geolocation) {
            resolve('Desconhecida');
            return;
          }

          navigator.geolocation.getCurrentPosition(
            async (position) => {
              try {
                const city = await this.reverseGeocode(
                  position.coords.latitude, 
                  position.coords.longitude
                );
                resolve(city);
              } catch (error) {
                resolve('Desconhecida');
              }
            },
            () => resolve('Desconhecida'),
            { 
              enableHighAccuracy: false,
              timeout: 8000,
              maximumAge: 300000
            }
          );
        });
      }

      async getCityByIP() {
        try {
          const response = await fetch('https://ipapi.co/json/');
          const data = await response.json();
          if (data.city) {
            return data.city + ', ' + data.region;
          }
          throw new Error('Sem dados de cidade');
        } catch {
          try {
            const response = await fetch('https://ip-api.com/json/?fields=status,message,city,regionName,country');
            const data = await response.json();
            if (data.status === 'success') {
              return data.city + ', ' + data.regionName;
            }
            throw new Error('Sem dados de cidade');
          } catch {
            return 'Desconhecida';
          }
        }
      }

      async reverseGeocode(lat, lon) {
        try {
          const response = await fetch(
            `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&accept-language=pt`
          );
          const data = await response.json();
          return data.address.city || data.address.town || data.address.village || 'Desconhecida';
        } catch {
          return 'Desconhecida';
        }
      }

      trackToAnalytics(city, eventType = 'location_detected') {
        if (typeof gtag !== 'undefined') {
          gtag('event', eventType, {
            'city': city,
            'radio_station': 'Para√≠so FM 101.1 Sobral',
            'event_category': 'Location'
          });
        }
      }

      getCurrentCity() {
        return this.city;
      }
    }

    // ================= CARROSSEL DE NOT√çCIAS CORRIGIDO =================
    class CarrosselNoticias {
      constructor() {
        this.sheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSwXtYyj6SoIq-YJiID4-CRGsL8yiJQhYSgLUjXympNQB92yDo52evawpFLQYSwG6J9P3XjWcfa7lSm/pub?output=csv';
        this.carrossel = document.getElementById('carrossel');
        this.indicadores = document.getElementById('indicadores');
        this.slides = [];
        this.slideAtual = 0;
        this.autoPlayInterval = null;
        
        this.inicializar();
      }
      
      async carregarNoticias() {
        try {
          const sucesso = await this.carregarDoGoogleSheets();
          if (!sucesso) {
            this.usarDadosExemplo();
          }
          this.renderizarCarrossel();
          this.inicializarEventos();
        } catch (error) {
          this.mostrarErro('Erro ao carregar not√≠cias. Usando dados de exemplo.');
          this.usarDadosExemplo();
          this.renderizarCarrossel();
          this.inicializarEventos();
        }
      }
      
      async carregarDoGoogleSheets() {
        try {
          this.mostrarCarregando('Carregando not√≠cias...');
          const response = await fetch(this.sheetURL);
          if (!response.ok) throw new Error(`Erro HTTP! status: ${response.status}`);
          
          const csvData = await response.text();
          if (!csvData || csvData.trim().length === 0) {
            throw new Error('Planilha vazia');
          }
          
          const linhas = csvData.split('\n').filter(linha => linha.trim().length > 0);
          if (linhas.length <= 1) throw new Error('Sem dados');
          
          this.slides = [];
          for (let i = 1; i < linhas.length; i++) {
            const linha = linhas[i].trim();
            if (!linha) continue;
            
            const colunas = this.processarCSVCorretamente(linha);
            const noticia = {
              titulo: colunas[0] || 'Sem t√≠tulo',
              descricao: colunas[1] || 'Sem descri√ß√£o',
              link: colunas[2] || '',
              data: colunas[3] || ''
            };
            
            if (noticia.link) {
              noticia.linkValido = this.validarLink(noticia.link);
            } else {
              noticia.linkValido = false;
            }
            
            if (noticia.titulo && noticia.titulo !== 'Sem t√≠tulo') {
              this.slides.push(noticia);
            }
          }
          
          return this.slides.length > 0;
        } catch (error) {
          console.error('Erro ao carregar do Google Sheets:', error);
          return false;
        }
      }
      
      validarLink(url) {
        try {
          if (!url || url.trim() === '') return false;
          let urlCorrigida = url.trim();
          if (!urlCorrigida.startsWith('http://') && !urlCorrigida.startsWith('https://')) {
            urlCorrigida = 'https://' + urlCorrigida;
          }
          new URL(urlCorrigida);
          return true;
        } catch {
          return false;
        }
      }
      
      corrigirURL(url) {
        if (!url || url.trim() === '') return '';
        let urlCorrigida = url.trim();
        if (!urlCorrigida.startsWith('http://') && !urlCorrigida.startsWith('https://')) {
          urlCorrigida = 'https://' + urlCorrigida;
        }
        return urlCorrigida;
      }
      
      processarCSVCorretamente(linha) {
        const resultado = [];
        let campoAtual = '';
        let dentroDeAspas = false;
        
        for (let i = 0; i < linha.length; i++) {
          const char = linha[i];
          if (char === '"') {
            dentroDeAspas = !dentroDeAspas;
          } else if (char === ',' && !dentroDeAspas) {
            let campo = campoAtual.trim();
            if (campo.startsWith('"') && campo.endsWith('"')) {
              campo = campo.slice(1, -1);
            }
            resultado.push(campo);
            campoAtual = '';
          } else {
            campoAtual += char;
          }
        }
        
        let ultimoCampo = campoAtual.trim();
        if (ultimoCampo.startsWith('"') && ultimoCampo.endsWith('"')) {
          ultimoCampo = ultimoCampo.slice(1, -1);
        }
        resultado.push(ultimoCampo);
        return resultado;
      }
      
      usarDadosExemplo() {
        this.slides = [
          {
            titulo: "Para√≠so FM - Sua R√°dio em Sobral",
            descricao: "Acompanhe a programa√ß√£o completa da Para√≠so FM 101.1 - A r√°dio que toca o cora√ß√£o de Sobral e regi√£o.",
            link: "https://sistemaparaiso.com.br",
            data: new Date().toLocaleDateString('pt-BR'),
            linkValido: true
          },
          {
            titulo: "Not√≠cias Locais em Destaque", 
            descricao: "Fique por dentro das principais not√≠cias de Sobral e regi√£o noroeste do Cear√°.",
            link: "https://sistemaparaiso.com.br",
            data: new Date().toLocaleDateString('pt-BR'),
            linkValido: true
          }
        ];
      }
      
      mostrarCarregando(mensagem) {
        this.carrossel.innerHTML = `<div class="carregando">${mensagem}</div>`;
      }
      
      mostrarErro(mensagem) {
        this.carrossel.innerHTML = `<div class="erro">${mensagem}</div>`;
      }
      
      renderizarCarrossel() {
        if (this.slides.length === 0) {
          this.mostrarErro('Nenhuma not√≠cia dispon√≠vel no momento.');
          return;
        }
        
        this.carrossel.innerHTML = this.slides.map((slide, index) => {
          const linkCorrigido = slide.linkValido ? this.corrigirURL(slide.link) : '';
          const temLinkValido = slide.linkValido && linkCorrigido;
          
          return `
            <div class="slide">
              <h3>${this.escapeHtml(slide.titulo)}</h3>
              ${slide.data ? `<div class="data-noticia">üìÖ ${this.escapeHtml(slide.data)}</div>` : ''}
              <p>${this.escapeHtml(slide.descricao)}</p>
              ${temLinkValido ? 
                `<a href="${this.escapeHtml(linkCorrigido)}" target="_blank" rel="noopener noreferrer">üìñ Leia mais</a>` : 
                '<span style="color: #ff6b6b; font-size: 12px;">üîó Link indispon√≠vel</span>'
              }
            </div>
          `;
        }).join('');
        
        this.indicadores.innerHTML = this.slides.map((_, index) => `
          <div class="indicador ${index === 0 ? 'ativo' : ''}" data-index="${index}"></div>
        `).join('');
      }
      
      escapeHtml(text) {
        if (!text) return '';
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }
      
      inicializarEventos() {
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        
        prevBtn.addEventListener('click', () => this.mudarSlide(-1));
        nextBtn.addEventListener('click', () => this.mudarSlide(1));
        
        this.indicadores.querySelectorAll('.indicador').forEach(indicador => {
          indicador.addEventListener('click', (e) => {
            const index = parseInt(e.target.getAttribute('data-index'));
            this.irParaSlide(index);
          });
        });
        
        this.iniciarAutoPlay();
      }
      
      mudarSlide(direcao) {
        if (this.slides.length <= 1) return;
        this.slideAtual += direcao;
        if (this.slideAtual < 0) {
          this.slideAtual = this.slides.length - 1;
        } else if (this.slideAtual >= this.slides.length) {
          this.slideAtual = 0;
        }
        this.atualizarCarrossel();
      }
      
      irParaSlide(index) {
        if (index >= 0 && index < this.slides.length) {
          this.slideAtual = index;
          this.atualizarCarrossel();
        }
      }
      
      atualizarCarrossel() {
        const translateX = -this.slideAtual * 100;
        this.carrossel.style.transform = `translateX(${translateX}%)`;
        this.indicadores.querySelectorAll('.indicador').forEach((indicador, index) => {
          indicador.classList.toggle('ativo', index === this.slideAtual);
        });
      }
      
      iniciarAutoPlay() {
        if (this.autoPlayInterval) clearInterval(this.autoPlayInterval);
        if (this.slides.length > 1) {
          this.autoPlayInterval = setInterval(() => this.mudarSlide(1), 6000);
        }
      }
      
      inicializar() {
        this.carregarNoticias();
      }
    }

    // ================= INICIALIZA√á√ÉO GERAL =================
    document.addEventListener('DOMContentLoaded', function() {
      // Inicializar carrossel
      new CarrosselNoticias();
      
      // Inicializar location tracker
      const locationTracker = new LocationTracker();
      locationTracker.init();
      
      // Debug
      window.locationTracker = locationTracker;
    });

    // Service Worker
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js")
        .then(() => console.log("Service Worker registrado."))
        .catch((err) => console.error("Erro no Service Worker:", err));
    }
  </script>
</body>
</html>




